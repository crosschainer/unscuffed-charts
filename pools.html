<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Snaklytics - Liquidity Pools</title>
  <meta name="description"
    content="Xian DEX Research - Explore and manage liquidity pools on the Xian Dex, Snakexchange." />
  <meta name="keywords" content="Xian Dex, Snakexchange, liquidity pools, crypto analytics, blockchain research" />
  <meta name="author" content="Xian Dex Research Team" />
  <link rel="icon" href="/assets/logo.png?v=1" type="image/png" sizes="192x192" />
  <link rel="apple-touch-icon" href="/assets/logo.png?v=1" type="image/png" sizes="192x192" />
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            inter: ["Inter", "ui-sans-serif", "system-ui"],
          },
          colors: {
            brand: {
              cyan: "#08FBD6",
              magenta: "#C400FF",
              indigo: "#44A4FF",
              base: "#060708",
              card: "#0d0e11",
            },
          },
          boxShadow: {
            neon: "0 0 12px rgba(8, 251, 214, 0.6)",
          },
        },
      },
    };
  </script>

  <!-- Inter font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <!-- Custom CSS -->
  <link href="assets/styles.css?v=8" rel="stylesheet" />
</head>

<body id="poolsPage" class="font-inter bg-brand-base text-gray-200 min-h-screen flex flex-col">
  <!--Brand and Menu Bar -->
  <header class="flex items-center gap-2 h-10 px-4
               border-b border-white/5 bg-brand-card/90 backdrop-blur-sm
               shrink-0">
    <div class="flex items-center space-x-3">
      <img src="assets/logo.png" alt="Snaklytics Logo" class="h-6 w-6" />
      <span class="text-lg font-semibold text-gray-100 tracking-wide">Snaklytics</span>
    </div>

    <!-- Navigation -->
    <nav class="ml-6 flex items-center space-x-4">
      <a href="index.html" class="text-sm text-gray-400 hover:text-white transition">Trading</a>
      <a href="pools.html" class="text-sm text-brand-cyan border-b border-brand-cyan pb-0.5">Pools</a>
    </nav>

    <!-- push button to the right -->
    <div class="flex-1"></div>

    <!-- Connect Wallet button -->
    <button id="connectBtn" class="flex items-center gap-1 px-3 py-1
                 rounded-md border border-brand-cyan text-brand-cyan
                 hover:bg-brand-cyan/10 active:bg-brand-cyan/20
                 focus:outline-none focus:ring-2 focus:ring-brand-cyan
                 transition">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-4 h-4 fill-current">
        <path
          d="M2 7a3 3 0 0 1 3-3h14a3 3 0 0 1 3 3v1h-2V7a1 1 0 0 0-1-1H5a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-1h2v1a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V7z" />
        <circle cx="18" cy="12" r="1.5" />
      </svg>
      <span class="text-sm font-medium">Connect Wallet</span>
    </button>
  </header>

  <!-- Main content -->
  <main class="flex-1 container mx-auto px-4 py-6 max-w-5xl">
    <div class="flex items-center justify-between mb-6">
      <h1 class="text-2xl font-bold">Liquidity Pools</h1>
      <div class="relative">
        <input id="poolsSearch" type="text" placeholder="Search by token contract..." 
               class="w-full md:w-64 rounded-md bg-white/5 px-3 py-2 text-sm
                      placeholder-gray-400 focus:outline-none
                      focus:ring-2 focus:ring-brand-cyan" />
      </div>
    </div>

    <!-- Pools list -->
    <div id="poolsScroller" class="overflow-y-auto">
      <div id="poolsList" class="space-y-4">
        <!-- Pool items will be inserted here -->
        <div class="animate-pulse">
          <div class="h-16 bg-white/5 rounded-md mb-3"></div>
          <div class="h-16 bg-white/5 rounded-md mb-3"></div>
          <div class="h-16 bg-white/5 rounded-md mb-3"></div>
          <div class="h-16 bg-white/5 rounded-md mb-3"></div>
          <div class="h-16 bg-white/5 rounded-md mb-3"></div>
        </div>
      </div>
    </div>
  </main>

  <!-- Toasts land here -->
  <div id="toastContainer" class="fixed top-4 right-4 z-50 space-y-2 pointer-events-none"></div>

  <!-- Wallet-missing modal -->
  <div id="walletModal" class="fixed inset-0 z-50 hidden flex items-center justify-center">
    <!-- backdrop -->
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>

    <!-- panel -->
    <div class="relative w-[92%] max-w-sm rounded-lg bg-brand-card
              border border-white/10 shadow-xl px-6 py-5
              text-gray-200 animate-scale-in">
      <!-- close "×" -->
      <button id="wmClose" class="absolute top-2 right-2 p-1 rounded hover:bg-white/10">
        <svg class="w-4 h-4" viewBox="0 0 24 24">
          <path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>

      <h2 class="text-lg font-semibold mb-3 flex items-center gap-2">
        <svg class="w-5 h-5 shrink-0" viewBox="0 0 24 24" fill="none">
          <path stroke="#08FBD6" stroke-width="2" d="M12 2L2 7l10 5 10-5-10-5z
                 M2 17l10 5 10-5M2 12l10 5 10-5" />
        </svg>
        Xian Wallet required
      </h2>

      <p class="text-sm leading-relaxed mb-4">
        To manage liquidity on Snaklytics you need the Xian Wallet browser
        extension or Android app.
      </p>

      <div class="space-y-2">
        <a href="https://chromewebstore.google.com/detail/xian-wallet/kcimjjhplbcgkcnanijkolfillgfanlc?pli=1"
          target="_blank" rel="noopener" class="flex items-center gap-2 w-full px-3 py-2 rounded-md
                bg-emerald-600/10 hover:bg-emerald-600/20">
          <img src="assets/chrome.svg" class="w-5 h-5" alt="">
          <span class="text-sm">Get Chrome extension</span>
        </a>

        <a href="https://play.google.com/store/apps/details?id=net.xian.xianwalletapp" target="_blank" rel="noopener"
          class="flex items-center gap-2 w-full px-3 py-2 rounded-md
                bg-emerald-600/10 hover:bg-emerald-600/20">
          <img src="assets/playstore.svg" class="w-5 h-5" alt="">
          <span class="text-sm">Get Android wallet</span>
        </a>
      </div>

      <p class="text-center mt-5 text-xs text-gray-400">
        Already installed?&nbsp;
        <button id="wmRetry" class="underline underline-offset-2 hover:text-gray-200">
          Retry connection
        </button>
      </p>
    </div>
  </div>

  <script src="assets/dapp.js"></script>
  <script src="assets/dapp-func.js?v=5"></script>
  <script type="module">
    import { initPools } from './assets/pools.js';
    
    // Initialize wallet modal functionality
    const walletModal = document.getElementById('walletModal');
    const wmClose = document.getElementById('wmClose');
    const wmRetry = document.getElementById('wmRetry');
    const connectBtn = document.getElementById('connectBtn');
    
    function openWalletModal() { walletModal.classList.remove('hidden'); }
    function closeWalletModal() { walletModal.classList.add('hidden'); }
    
    wmClose.onclick = closeWalletModal;
    wmRetry.onclick = () => { closeWalletModal(); connectWallet(); };
    connectBtn.addEventListener('click', connectWallet);
    
    async function connectWallet() {
      try {
        // Loading state
        connectBtn.innerHTML = `
          <svg class="w-5 h-5 animate-spin text-brand-cyan" 
            xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-20" cx="12" cy="12" r="10" 
                  stroke="currentColor" stroke-width="4"/>
            <path class="opacity-90" fill="currentColor"
                d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"/>
          </svg>
          <span class="text-sm font-medium">Connecting…</span>`;
          
        const info = await XianWalletUtils.requestWalletInfo();
        
        if (info.locked) {
          toast('Unlock your Xian Wallet first', 'error');
          resetBtn();
          return;
        }
        
        /* success! */
        userAddress = info.address;
        showAddress(userAddress);
        toast(`Connected to ${userAddress}`, 'success');
        
        // Refresh any open pool details to show LP balances
        document.querySelectorAll('[id^="pool-details-"]:not(.hidden)').forEach(el => {
          const poolId = el.id.replace('pool-details-', '');
          loadLpBalance(poolId);
        });
        
      } catch (err) {
        openWalletModal();
        console.error(err);
        resetBtn();
      }
    }
    
    function showAddress(addr) {
      connectBtn.innerHTML = `
        <svg viewBox="0 0 24 24" class="w-4 h-4 fill-current"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm1-13h-2v6h2V7zm0 8h-2v2h2v-2z"/></svg>
        <span class="text-sm font-medium">Connected</span>`;
      connectBtn.blur();
    }
    
    function resetBtn() {
      connectBtn.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-4 h-4 fill-current">
          <path d="M2 7a3 3 0 0 1 3-3h14a3 3 0 0 1 3 3v1h-2V7a1 1 0 0 0-1-1H5a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-1h2v1a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V7z" />
          <circle cx="18" cy="12" r="1.5" />
        </svg>
        <span class="text-sm font-medium">Connect Wallet</span>`;
    }
    
    function toast(message, type = 'success') {
      const wrap = document.getElementById('toastContainer');
      if (!wrap) return;
      
      // Toast element
      const el = document.createElement('div');
      el.className = `
        flex items-center gap-2
        px-4 py-2 rounded shadow-lg text-sm text-white
        ${type === 'error' ? 'bg-rose-600' : 'bg-emerald-600'}
        opacity-0 translate-y-2 scale-95
        transition-all duration-200
        pointer-events-auto`;
      
      el.innerHTML = `
        ${type === 'error'
          ? '<svg class="w-4 h-4 fill-current" viewBox="0 0 24 24"><path d="M11 7h2v6h-2V7zm0 8h2v2h-2v-2z"/><path d="M1 21h22L12 2 1 21z"/></svg>'
          : '<svg class="w-4 h-4 fill-current" viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>'}
        <span>${message}</span>
      `;
      
      wrap.appendChild(el);
      
      // Animate in on next frame
      requestAnimationFrame(() =>
        el.classList.remove('opacity-0', 'translate-y-2', 'scale-95'));
      
      // Auto-remove after 3s + fade out
      setTimeout(() => {
        el.classList.add('opacity-0', 'translate-y-2', 'scale-95');
        el.addEventListener('transitionend', () => el.remove(), { once: true });
      }, 3000);
    }
    
    // Initialize the pools page
    document.addEventListener('DOMContentLoaded', initPools);
  </script>
</body>

</html>